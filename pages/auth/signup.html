<html lang="en"><head>  <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mohassabatech</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <script src="../../script.js"></script>
    <style>
        body {
            
            font-family: "Inter", sans-serif;
            background-color: #f7fafc;
            color: #2d3748;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
    .signup-box {
      max-width: 500px;
      margin: 20px auto;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .signup-box h2 {
      margin-bottom: 20px;
      color: #2d3748;
      font-size: 1.8rem;
    }

    .role-select,
    .input-group {
      margin-bottom: 15px;
      text-align: left;
    }
    .input-group input[type="text"],
    .input-group input[type="email"],
    .input-group input[type="password"] {
      width: calc(100% - 22px);
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 1em;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .role-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .role-options label {
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .hidden {
      display: none;
    }
    button {
      background-color: #4299e1;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background-color: #2b6cb0;
    }

    .separator {
      border-top: 1px solid #e2e8f0;
      margin: 20px 0;
    }

    .login-link {
      text-align: center;
      color: #718096;
    }

    .login-link a {
      color: #4299e1;
      text-decoration: none;
        }
        .error {
            color: red;
        }
    </style>
<!--UIPATH_EXTENSION_ID: conkfbpnllelocpogdmbilgmnkabjfmf--></head>
  
<body class="font-inter bg-gray-100">
  
    <main class="flex-1 py-8 px-4 sm:px-6 lg:px-8 mt-16">
        <div class="signup-box">
            <h2>Sign Up</h2>
            <form id="signupForm">
                <div class="role-select">
                    <label>I am signing up as:</label>
                    <div class="role-options">
                        <label><input type="radio" name="role" value="accountant" id="accountantRole">
              Accountant</label>
            <label><input type="radio" name="role" value="business" id="businessRole">
              Business</label>
          </div>
                </div>

                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" placeholder="Choose a username" required="">
        </div>
        <div class="input-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="Your email" required="">
        </div>
        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" placeholder="Your password">
        </div>

        <div id="accountantFields" class="hidden">
          <div class="input-group">
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName" placeholder="Your full name">
          </div>
                    <div class="input-group">
            <label for="phoneNumber">Phone Number</label>
            <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Your phone number">
          </div>
            <div id="accountantSpecializations" class="hidden mt-4">
                <p class="mb-2 font-bold">Accountant Specializations:</p>
                <div class="flex flex-col space-y-2">
                    <div>
                        <input type="checkbox" id="charteredAccountant" name="specialization" value="chartered">
                        <label for="charteredAccountant">Chartered Accountant</label>
                    </div>
                    <div>
                        <input type="checkbox" id="accountant" name="specialization" value="accountant">
                        <label for="accountant">Accountant</label>
                    </div>
                    <div>
                        <input type="checkbox" id="auditor" name="specialization" value="auditor">
                        <label for="auditor">Auditor</label>
                    </div>
        </div>
      </div>
      </div>

        <div id="businessFields" class="hidden">
          <div class="input-group">
            <label for="businessName">Business Name</label>
            <input type="text" id="businessName" name="businessName" placeholder="Business name">
          </div>
          <div class="input-group">
            <label for="businessPhone">Business Phone Number</label>
            <input type="text" id="businessPhone" name="businessPhone" placeholder="Business phone number">
          </div>
          <div class="business-type-selection hidden">
            <label for="business-type" class="block mb-2 font-bold">Business Type:</label>
            <select id="business-type" name="business-type" class="w-full p-2 border border-gray-300 rounded">
              <option value="sarl">SARL</option>
              <option value="spa">SPA</option>
              <option value="eurl">EURL</option>
            </select>
          </div>
          
                </div>

                
                <button type="submit">Create Account</button>
                 </form>
                  <hr class="separator">
                 <p class="login-link">
                Already have an account?
                <a href="auth.html">Log in</a>
            </p>
        </div>
        <script type="module">
            // Firebase Imports and Initialization
            import {
                initializeApp
            } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc, // Add setDoc here
        collection, // Add collection import
        query, // Add query import
        getDocs, // Add getDocs import
        where,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";
        
    

            const firebaseConfig = {
                apiKey: "AIzaSyBt4iqIQljxLZvuedUBBdwqE-GnWcRbcbs",
        authDomain: "mohassabatech-pro.firebaseapp.com",
        projectId: "mohassabatech-pro",
        storageBucket: "mohassabatech-pro.firebasestorage.app",
        messagingSenderId: "885034594340",
        appId: "1:885034594340:web:82599328783db409a3e8b1",
        measurementId: "G-7DTQNZK1F4",
      };
      const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // Function to display a toast message
      async function displayToast(message, type = "success") {
        try {
          const toastContainer = document.createElement("div");
          toastContainer.classList.add("toast-container");
          document.body.appendChild(toastContainer);

          const toast = document.createElement("div");
          toast.classList.add("toast", type);
          toast.textContent = message;
          toastContainer.appendChild(toast);

          setTimeout(() => {
            toast.remove();
            toastContainer.remove();
          }, 3000); // Remove after 3 seconds
        } catch (error) {
          console.error("Error displaying toast:", error);
            }
      }
    
      // Function to display errors
      async function displayError(message, containerClass = "signup-box") {
        try {
          const errorContainer = document.querySelector(`.${containerClass}`);
          if (!errorContainer) {
            console.error("Error container not found.");
            return;
          }
          errorContainer.querySelectorAll(".error").forEach((el) => el.remove());
          const errorDiv = document.createElement("div");
          errorDiv.classList.add("error");
          errorDiv.textContent = message;
          errorContainer.prepend(errorDiv);
          setTimeout(() => {
            errorDiv.remove();
          }, 3000);
        } catch (error) {
          console.error("Error displaying error:", error);
        }
            }

      // Function to handle user sign up
      async function handleUserSignUp(event) {
        try {
          event.preventDefault();
          const form = event.target;
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());
          const role = data.role;
          if (!role) {
            await displayError("Please select a role.");
            return;
          }
          const requiredFields =
            role === "accountant"
              ? [
                  "username",
                  "email",
                  "password",
                  "fullName",
                  "phoneNumber",
                ]
              : ["username", "email", "password", "businessName", "businessPhone"];
          const isFormValid = requiredFields.every(
            (field) => data[field] && data[field].trim() !== ""
          );
          if (!isFormValid) {
            await displayError("Please fill in all required fields.");
                return;
          }
          const email = data.email;
          const password = data.password;
          const username = data.username;
            const fullName = data.fullName;
          const phoneNumber = data.phoneNumber;
            const businessName = data.businessName;
          const businessPhone = data.businessPhone;

          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          const userDocData = {
            uid: user.uid,
            username: username,
            email: email,
          };
          if (role === "accountant") {
                userDocData.fullName = fullName;
            userDocData.phoneNumber = phoneNumber;
            // Handle specializations
            const specializations = [];
            // Get all entries from FormData
            for (const [key, value] of formData.entries()) {
              if (key === 'specialization') {
                specializations.push(value);
              }
            }

            // Ensure accountantType is an empty array if no specializations are selected
            if (specializations.length === 0) {
              userDocData.accountantType = [];
            } else {
            userDocData.accountantType = specializations;
            }

            userDocData.role = "accountant";

            
          } else if (role === "business") {
            userDocData.businessName = businessName;
            userDocData.businessPhone = businessPhone;
            // Handle business type
            const businessType = data["business-type"];
            userDocData.businessType = businessType;
            userDocData.role = "business";
          }
           // Check if user already exists
        const usersCollection = collection(db, "users");
        const userQuery = query(usersCollection, where("email", "==", email));
        const querySnapshot = await getDocs(userQuery);
        if (!querySnapshot.empty) {
          await displayError("This email is already registered. Please use a different email.");
          return;
            } else if (role === "business") {
                userDocData.businessName = businessName;
                userDocData.businessPhone = businessPhone;
                userDocData.role = "business";
            } 
          await setDoc(doc(collection(db, "users")),{...userDocData, uid : user.uid});
          await displayToast("Signup successful!");

          if (role === "accountant") {
                //use role
                window.location.href = "../dashboard/accntdash.html"; // Redirect to accountant dashboard
            } else if (role === "business") {
            //use role
            window.location.href = "../dashboard/bsndash.html"; // Redirect to business dashboard
          }
        } catch (error) {
          const errorMessage = error.message;
        
          await displayToast("Signup faild check your conection!", "error");
          await displayError(errorMessage);
          console.error("Error signing up:", error);
        }
      }

      function toggleFields() {
        const accountantFields = document.getElementById("accountantFields");
        const businessFields = document.getElementById("businessFields");
        const businessTypeSelection = document.querySelector(".business-type-selection");
        const accountantSpecializations = document.getElementById("accountantSpecializations");
        const accountantRoleRadio = document.getElementById("accountantRole");
        const businessRoleRadio = document.getElementById("businessRole");
        if (accountantRoleRadio.checked) {
            accountantFields.classList.remove("hidden");
            businessFields.classList.add("hidden");
            businessTypeSelection.classList.add("hidden");
            accountantSpecializations.classList.remove("hidden");
        } else if (businessRoleRadio.checked) {
            businessFields.classList.remove("hidden");
            accountantFields.classList.add("hidden");
            businessTypeSelection.classList.remove("hidden");
            accountantSpecializations.classList.add("hidden");
        } else {
            accountantFields.classList.add("hidden");
            businessFields.classList.add("hidden");
            businessTypeSelection.classList.add("hidden");
            accountantSpecializations.classList.add("hidden");
        }
    }

      document
        .querySelectorAll('input[name="role"]')
        .forEach((radio) =>
          radio.addEventListener("change", async () => {
            await toggleFields();
          })
        );
      document.addEventListener("DOMContentLoaded", async () => {
        await toggleFields();
      });

      // Get radio buttons and add event listeners
      const accountantRoleRadio = document.getElementById("accountantRole");
      const businessRoleRadio = document.getElementById("businessRole");
      accountantRoleRadio.addEventListener("change", toggleFields);
      businessRoleRadio.addEventListener("change", toggleFields);
      toggleFields();
      // Add event listener to the form for sign up handling
      document
        .getElementById("signupForm")
        .addEventListener("submit", handleUserSignUp);
    </script>
    </main>
    <footer class="py-4 text-center text-gray-700 bg-white">
        <p>© {new Date().getFullYear()} Mohassabatech. All rights reserved.</p>
    </footer>


    <script>
      fetch('../../locales/en.json')
          .then(response => response.json())
          .then(englishTranslations => {
              fetch('../../locales/fr.json')
                  .then(response => response.json())
                  .then(frenchTranslations => {
                      fetch('../../locales/ar.json')
                          .then(response => response.json())
                          .then(arabicTranslations => {
                              i18next.init({
                                  lng: localStorage.getItem('selectedLanguage') || 'en',
                                  
                                  resources: {
                                      en: {
                                          translation: englishTranslations
                                      },
                                      fr: {
                                          translation: frenchTranslations
                                      },
                                      ar: {
                                          translation: arabicTranslations
                                      }
                                  }
                              }).then(function (t) {
                                  updateContent();
                                  const languageSwitcher = document.getElementById('language-switcher');
                                  languageSwitcher.value = i18next.language;
                                  languageSwitcher.addEventListener('change', function () {
                                      const selectedLanguage = languageSwitcher.value;
                                      i18next.changeLanguage(selectedLanguage).then(() => {
                                          updateContent();
                                          localStorage.setItem('selectedLanguage', selectedLanguage);
                                      });
                                  });
                              });
  
                              function updateContent() {
                                  document.querySelectorAll('[data-i18n]').forEach(function (element) {
                                      element.textContent = i18next.t(element.dataset.i18n);
                                  });
                                  if (i18next.language == "ar") {
                                      document.body.classList.add('arabic-layout');
                                  } else {
                                      document.body.classList.remove('arabic-layout');
                                  }
                              }
                          });
                  });
          });
          
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.7.16/i18next.min.js"></script>
 </body></html>